# Lezione di mercoledì 24 aprile 2024

## Certificazione

Un valido certificato si compone di almeno tre elementi essenziali: due elementi congiunti e un terzo elemento che identifica l'autorità di certificazione (la quale deve essere autenticata tramite firma digitale).

La certificazione è intrinsecamente una catena di fiducia che si estende attraverso un numero potenzialmente infinito di passaggi; in ultima analisi, giungiamo a una radice autocertificata.

Limitare il numero di autorità di radice, rendendole invalicabili e non espandibili, costituisce una precauzione essenziale che rinforza l'intera catena di fiducia.

Le radici dei certificati risiedono nel nostro browser; solo le catene di certificati che si collegano a una delle radici memorizzate nel browser saranno considerate valide.

L'obiettivo primario è autenticare un URL, e per farlo si utilizza TLS, un protocollo crittografico a chiave pubblica. Questo richiede un certificato valido.

L'URL dovrebbe essere facilmente memorizzabile e indicativo; l'autenticazione richiede una dichiarazione di identità che consente all'utente di verificare l'affermazione fatta.

Senza autenticazione, i contenuti di una pagina web non possono essere considerati affidabili.

Ma dove risiede la misura dell'autenticazione? I browser autenticano un sito tramite il simbolo del lucchetto verde, e l'utente deve fidarsi della genuinità del browser. La conferma dell'autenticazione viene comunicata dall'utente al browser attraverso il lucchetto chiuso, affermando che l'URL corrisponde a ciò che dichiara e che il sito è autentico.

Tuttavia, l'autenticazione non garantisce la qualità; alcuni siti potrebbero essere compromessi da vulnerabilità, rendendoli potenzialmente pericolosi.

## Certificato X.509

Il formato ufficiale dei certificati X.509 comprende:

- Versione
- Numero di certificato
- Identificativo della firma
- Nome del fornitore del certificato
- Periodo di validità (con possibilità di revoca in caso di compromissione della chiave privata o altri eventi, con una relativa fiducia nel certificato)
- Nome del soggetto (A)
- Informazioni pubbliche (Ka)
- Identificativo dell'emittente (CA)
- Identificativo del soggetto (A)
- Estensioni
- Firma (che può comprendere sia la coppia di chiavi che solo la seconda componente, ovvero la cifratura del digest della parte chiave)

La firma, essenziale per la verifica dell'autenticità del certificato, può includere sia la coppia di chiavi che solo la cifratura del digest della parte chiave.

## Infrastruttura a Chiave Pubblica (PKI)

La Public-Key Infrastructure (PKI) è una struttura ad albero composta da certificazioni.

Ad esempio, il rettore certifica le firme dei direttori di dipartimento, i direttori di dipartimento a loro volta certificano i propri docenti.

Quando si deve certificare una "foglia" (ossia un'entità finale, come un singolo docente), non è necessario certificare l'intero albero, ma solo il percorso a ritroso dalla foglia fino alla radice. Questo processo richiede uno sforzo con complessità logaritmica.

## Chain Of Trust (Catena di fiducia)

## Catena di Fiducia (Chain of Trust)

Il certificato di root (RCA) è l'unica entità autocertificata, e lo store dei certificati di root è vulnerabile e suscettibile agli attacchi.

Se un aggressore riesce maliziosamente ad inserire un certificato di root ({badRCA, KbadRCA}k-1badRCA), questo equivale a convertire la fiducia in un attacco diretto.

A sua volta, badRCA potrebbe emettere certificati per gli URL di sua proprietà, generando una nuova coppia di chiavi e firmando con la chiave di root.

Fare un attacco del genere era relativamente semplice qualche anno fa, poiché l'importazione non richiedeva autorizzazioni di amministratore. Oggi, il metodo di alzare i privilegi rende l'attacco più complesso, ma rimangono possibili vulnerabilità pratiche (bug) che potrebbero consentire l'attacco.

La trust base del browser è estensibile per scopi funzionali, quindi è possibile aggiungere certificati.

Qual è la differenza tra un certificato di root di Verisign e uno homemade? Sintatticamente sono identici.

Come vengono gestiti i sottodomini? Usando i "wildcards", il fornitore offre un numero limitato di certificati che coprono tutti i suoi sottodomini. La perdita di fiducia si propaga verso il basso lungo la catena.

## Segretezza vs Fiducia

Se ipotizziamo che un certificato sia compromesso, ad esempio se un'autorità di certificazione perde la propria chiave privata, ciò non implica automaticamente che lo stesso problema si propaghi ai suoi sotto-alberi, ovvero ai certificati emessi da essa.

I problemi di sicurezza, come la perdita della chiave privata, non si estendono oltre la propria entità; tuttavia, i problemi di fiducia si propagano. Questo significa che se un'autorità di certificazione perde la fiducia a causa di una compromissione, anche i certificati emessi da essa rischiano di non essere più considerati affidabili, causando una diffusione del problema lungo la catena di fiducia.

## Certificati auto-emessi

Quando il browser non riesce a verificare l'identità di un sito web, l'utente ha tre opzioni:

- Non accettare il certificato e non connettersi al sito web.
- Accettare temporaneamente il certificato, rendendolo valido solo per la sessione corrente.
- Accettare il certificato in modo permanente.

Se si accetta il certificato temporaneamente, si espone a numerose possibilità di attacchi di "man-in-the-middle". Ad esempio, ogni volta che si tenta di effettuare l'accesso, le richieste possono essere intercettate sulla rete locale e reindirizzate verso un sito fasullo non certificato. Questo crea un rischio concreto di spoofing.

Accettare il certificato in modo permanente, d'altra parte, equivale a fare un atto di fede nei confronti del sito web, poiché si assume che tutte le future connessioni saranno sicure.

In termini di impatto, entrambe le opzioni sono equivalenti, ma la verosimiglianza di un potenziale rischio è differente.

### Questo scenario è sempre meno comune per diverse ragioni:

- **Costi ridotti della certificazione:** Grazie a servizi come Let's Encrypt, che offre certificati gratuiti, e alla diminuzione dei costi complessivi della certificazione, ottenere un certificato è diventato più accessibile economicamente.
- **Facilità di ottenimento dei certificati:** Let's Encrypt, supportato da un consorzio di autorità di certificazione, ha semplificato notevolmente il processo di ottenimento dei certificati, rendendolo disponibile per tutti i tipi di siti web, compresi i sottodomini.
- **Tipologie di certificati:** Anche se Let's Encrypt offre principalmente certificati di tipo Domain Validated (DV), che richiedono solo una validazione del dominio, ci sono altre tipologie di certificati come quelli di tipo Extended Validation (EV) e Organization Validated (OV) che offrono livelli di validazione più elevati, specialmente per siti sensibili come le banche.
- **Differenze visive nei browser:** Alcuni browser forniscono indicazioni visive diverse per i diversi tipi di certificati, come le barre degli indirizzi colorate o i segni di sicurezza, che aiutano gli utenti a identificare i siti affidabili.
- **Certificate Transparency:** Questa tecnologia aiuta a garantire che i certificati siano autentici e rende più difficile per gli aggressori utilizzare certificati fraudolenti.
- **Rischi associati ai cambi di certificato:** Il cambio repentino di certificato può essere considerato sospetto e potrebbe essere un segno di un possibile attacco in corso.

In generale, l'aumentata disponibilità e accessibilità dei certificati, insieme a migliori pratiche di sicurezza e tecnologie aggiuntive come Certificate Transparency, hanno contribuito a rendere il web più sicuro e affidabile per gli utenti.

## Lista di Revoca dei Certificati (CRL)

La necessità di revocare un certificato può sorgere in vari contesti, come la perdita della chiave privata o il cambio del Subject Identifier.

Revocare un certificato è un'operazione altrettanto sensibile quanto rilasciarlo. Richiede la stessa autorità e solo l'entità che ha emesso il certificato può revocarlo.

Una Certificate Revocation List (CRL) è una lista di certificati revocati. Essenzialmente, una CRL è un oggetto statico, una sequenza di bit, un messaggio.

Se il browser non viene informato della CRL, potrebbe validare certificati che sono stati revocati. Tuttavia, attualmente non esiste un protocollo definito per la distribuzione delle CRL.

In passato, le CRL venivano scaricate da entità come Verisign e integrate nel browser. Oggi, esiste un protocollo chiamato Online Certificate Status Protocol (OCSP), che funziona verificando lo stato di validità di un certificato direttamente presso l'ente di certificazione ogni volta che un utente cerca di accedere a un URL. Questo processo aiuta a garantire che i certificati revocati non siano considerati validi durante le connessioni web.

## Protocollo di sicurezza: Autenticazione di Bob con Alice con l'aggiunta di freshness

I protocolli di sicurezza spesso mancano di reciprocità, il che può rappresentare un limite. Nel protocollo di autenticazione esaminato, l'autenticazione avviene tramite la chiave privata del mittente.

Per implementare un meccanismo di sfida e risposta (Challenge-Response), utilizziamo la chiave pubblica del destinatario.

1. Alice invia a Bob un messaggio cifrato con la chiave pubblica di Bob.
2. Bob decifra il messaggio utilizzando la sua chiave privata e risponde ad Alice con il messaggio in chiaro  m . Il focus qui è sull'autenticazione, non sulla confidenzialità del messaggio.

Tuttavia, il messaggio in chiaro letto da Alice non garantisce che stia comunicando effettivamente con Bob. Per questo motivo,  m  deve essere non prevedibile e quindi rappresentare una nonce.

1. Alice genera un numero casuale  Na  e lo cifra con la chiave pubblica di Bob, ottenendo {Na}Kb.
2. Bob riceve il messaggio da Alice, lo decifra con la sua chiave privata e lo restituisce ad Alice in chiaro. In questo contesto di Challenge-Response, la confidenzialità della nonce non è necessaria.

## Domande di esame

- Periodo di validità di un certificato (Motivi di business, il certificato si paga, motivi di sicurezza)
- Disamina in termini di verosimiglianza o impatto delle 3 opzioni dei certificati self-issued

## Ricerche per casa

- URL Squatting (Si usa per campagne di phishing etico)
- Let's encrypt: Protocolli di certificazione DV ed EV
- Certificate Pinning
- Certificate Transparency
- CRL Verisign
- Volume dei certificati revocati quotidianamente
- OSCP ed OCSP
