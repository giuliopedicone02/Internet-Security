# Lezione di lunedì 20 maggio 2024

# Parte 7: Software nocivo (Malware)

I trojan sono software nocivi, i penetration tester anche se etici possono nel loro lavoro impiantare malware.
Queste sono conseguenze dello sfruttamento di una vulnerabilità, exploitation.

Nesso tra attività offensiva e malware non è ovvio, l'uno non necessita per forza dell'altro.
Se un sistema (PC) ha una vulnerabilità come ad esempio il buffer overflow, le vulnerabilità sono nascoste se vengono trovate si chiama di hacking etico.

Virus: Tipologia di malware, si può ipotizzare che non ci siano vulnerabilità e di trovarci quindi in un sistema solido, l'utente effettua un donwload di un allegato con eseguibile (.exe, .bat) che rappresenta il malware. Il malware sfrutta i l sistema ospitante mlgrado esso sia solido in termini di vulnerabilità.

Lo scenario malware potrebbe non avere vulnerabilità, l'hacking etico va alla ricerca di vulnerabilità.

Vulnerabilità è sinonimo di bug, è una proprietà inattesa, il malware ha l'obiettivo esplicito di fare l'attacco.

Microsoft Defender: Antivirus, IDS e Firewall in un unico servizio. Software chiuso e monolitico.

Lo scenario malware va affrontato con un sistema antimalware o security center, ma uno scenario di vulnerabilità by design come va affrontato? Gli antivirus non trovano vulnerabilità, o se le riscontrano solo in rari casi. Soluzione: Aggiornamento software, atto di fede.

## Software nocivo - caratteristiche

 Carico: specifica violazione di 
sicurezza
Sempre presente 
 Propagazione: meccanismo di 
trasmissione fra le macchine
Non sempre presente
E’ più pericoloso il massimo carico o la massima propagazione?

## Software nocivo - tassonomia

Si suddividono in software che necessitano un programma ospitante e quelli indipendenti.

- Trapdoor
- Virus
- Bomba logica
- Trojan

- Zombie: Potenzialmente tutti i dispositivi IoT se vulnerabili possono essere trasformati in zombie
- Worm (Spyware)

## Trapdoor (Back door)

Punto di accesso segreto che oltrepassa le misure di sicurezza previste, è una vulnerabilità

Tipicamente implementate per comodità in passato per motivi di testing, security by oscurity.

## Approfondimento sulle vulnerabilità

Le vulnerabilità sono una specifica istanza di un problema su una specifica utenza. Esistono dei repo pubblici sui quali gli hacker etici pubblicano le vulnerabilità una volta trovate. Prima di pubblicarle è necessario che vengano fixate, dando al vendor il tempo di proteggersi (Vulnerability response).

Gli aggiornamenti software risolvono quindi le vulnerabilità note n-day presenti nei repo pubblici.
Una vulnerabilità zero day, non ancora documentata, viene sfruttata a favore dei delinquenti informatici. Quando un pentester fa attività offensiva potrebbe scoprire una zero day.

Zippando un file eseguibile tramite password ed allegandolo ad una mail è possibile farlo senza che il sistema lo riconosca, alcuni gestori di posta elettronica come Google viene comunque bloccato.

## Bomba logica

Particolare tipo di malware che si sviluppa e si manifesta al raggiugnimento di una certa condizione (come il raggiugnimento di un certo numero di utentui collegati simultanemanente in una piattaforma)

## Trojan

Interfaccia apparentemente innocua che invece ha poi un payload.
Esempio creazione di un link simbolico tra ls ed rm. Bisogna capire come inserirlo nel sistema (backdoor, ingegneria sociale)

## Zombie

Macchina remota già violata, si identifica come zombie la macchina violata o il software per lanciare nuovi attacchi, la distributività rende difficile tracciare l'entità malware

## Worm

Programma che infetta una amcchina remota che a loro volta infetteranno altre macchine remote.
Sono pericolosi perchè si trasmettono tra più devices.

Secondo la storia ufficiale Morris non viene condannato in quanto l'attaccante non aveva l'intenzione di effettuare un attacco, inoltre il suo worm ha un bug ed alcune versioni di esso non terminano e si replicavano continuamente sulla stessa macchina, di fatto, piantandola.

L'attacco di Morris sfruttava 3 vulnerabilità presenti in UNIX:
- Attacco su file di password di tipo known-cipertext: provo a fare encryption di password candidate fin quando non trovo quella corretta
- Buffer overflow su programma finger
- Back door nel programma sendmail

Sfruttando queste vulnerabilità era possibile divulgare il codice composto da 99 linee di codice C che si autocompilava ed eseguiva.

## Attacco known-ciphertext

Attacco di inversione dell'hash (crypt3) implementazione primordiale di una funzione hash, l'attacco di Morris si basava su attacco dizionario con word list

## Buffer Overflow mediante finger

Vulnerabilità di utilizzo ed allocazione erronea della memoria.

## Back door in sendmail

Modo per fare passare send mail come interpete di comando

## Virus

Programma nocivo che viola programmo non nocivi sfruttandoli per propagarsi.
Modificare dei bit a caso di un eseguibile, compromette l'eseguibile stesso che non funzionerà più.

Un carico tipico è l'aggiunta di pezzi di codice indesiderato, il trojan cammuffa invece script cattivi, il virus banalmente cancella o inserisce bit in modo che parte di un eseguibile non funzioni più.

Il riconoscimento del virus è un concetto tipico della biologia, esiste il concetto di firma del virus gli antivirus hanno bsogno di un aggiornamento delle firme dei virus. La firma di un virus non ha niente a che fare con la firma digitale.

I virus possono essere ovunque e difficili da trovare, cambiano forma o firma.

## Macrovirus

Le macro di Office nascondevano una intera categoria di virus, le macro sono le possibilità di automatizzare alcuni task, vengono lanciate all'avvio del programma.
Questi filtri possono avere delle vulnerabilità e l'attaccante potrebbe riuscire a nascondere degli exe.

## Software nocivo - distinzione delicata

Copiare la slide

## Struttura di un semplice virus

La firma di un virus è una stringa che permette al virus stesso di riconoscersi.
La firma nel target dove sta? Ovunque in un file, nell'esempio è nella prima riga.

Il virus stesso si deve riconoscere tramite la firma del virus, se nel mio target ad esempio nella prima linea trovo la mia firma lo riconosco come infettato e lo skippo altrimenti lo infettiamo.

## Antivirus 
L'antivirus è un programma chiuso che scansiona tutti i file controllando le firme dei virus in suo possesso.

Come dovrebbe essere fatto un antivirus?

Si scansionano i fuile uno dopo l'altro e verificando la prima linea si controlla la firma per identificarlo, se il virus fosse polimorfo si guardano righe differenti secondo un pattern noto.

L'antivirus e la sua scansione è oneroso per il nostro sistema, bisognava quindi automatizzare l'esecuzione dell'antivirus, ad oggi è un processo (programma in esecuzione) la periodicità di scansione viene decisa dal produttore.
Oggi gli antivirus sono residenti in memoria ma grazie alle capacità computazionali non ci accorgiamo del suo funzionamento in termini di prestazioni.

I virus di seconda generazione usano delle euristiche/strategie 

La terza generazione ricerca azioni illecite

La quarta generazione ha un insieme di tecniche del controllo di accesso incluso l'IPS Intrusion Prevention System

Si può percepire l'arrivo di un file anche tramite il cambiamento della dimensione di un file presente nel sistema dovuta all'inserimento della firma al suo interno.

## Virus che comprime

Il virus potrebbe essere rilevato controllando la dimensione del file, quindi il virus potrebbe comprimere il file fin quando che il file compresso + virus abbia la stessa dimensione del file originale, bisogna quindi inventare una nuova strategia di difesa.

## Esempio di virus: Brain

Brain rinomina il volume del disco, alcune versioni di brain cancellano pezzi di Hard Disk propagandosi.
Risiede in memoria alta in modo tale che non venga sovrascritto, in questa versione è un semplice man in the middle e non crea danni, gestisce però tutte le operazione di Input Output.
Si propaga inserendo la sua firma e propagandosi con i dati.
Marcava i settori infetti come danneggiati restringendo lo spazio a disposizione.

## Rimozione di Software Nocivo

L'antivirus è solo un'area delle difese da virus, esiste anche un'area chiamata Immune System ed esiste anche un'area di software sentinella, il sistema operativo fa un controllo sul codice ogni volta che lo eseguiamo.

## Domande di esame

- Trojan malware
- Nesso tra attività offensiva e software nocivo
- Allegati nella mail, floppy disk, metodologie di distribuzione dei malware
- Bug VS Malware
- Differenza tra bug e software nocivo: intenziionalità punita dalla legge
- Esemplificazione del Morris Worm
- Definzione di un virus
- Esemplificazione del gioco di attacco e sicurezza riportato al caso dei virus e del rilevamento